<!DOCTYPE html>
<html xmlns:v="urn:schemas-microsoft-com:vml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>流程图DEMO</title>
    <!--[if lt IE 9]>
    <?import namespace="v" implementation="#default#VML" ?>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="../codebase/GooFlow.css" />
    <style>
        .myForm {
            display: block;
            margin: 0px;
            padding: 0px;
            line-height: 1.5;
            border: #ccc 1px solid;
            font: 12px Arial, Helvetica, sans-serif;
            margin: 5px 5px 0px 0px;
            border-radius: 4px;
        }

            .myForm .form_title {
                background: #428bca;
                padding: 4px;
                color: #fff;
                border-radius: 3px 3px 0px 0px;
            }

            .myForm .form_content {
                padding: 4px;
                background: #fff;
            }

                .myForm .form_content table {
                    border: 0px;
                }

                    .myForm .form_content table td {
                        border: 0px;
                    }

                    .myForm .form_content table .th {
                        text-align: right;
                        font-weight: bold;
                    }

            .myForm .form_btn_div {
                text-align: center;
                border-top: #ccc 1px solid;
                background: #f5f5f5;
                padding: 4px;
                border-radius: 0px 0px 3px 3px;
            }

        #propertyForm {
            float: left;
        }
    </style>
    <script type="text/javascript" src="child.js"></script>
    <script type="text/javascript" src="../plugin/jquery.min.js"></script>
    <script type="text/javascript" src="../codebase/GooFunc.js"></script>
    <script type="text/javascript" src="../plugin/printThis.js"></script>
    <script type="text/javascript" src="../plugin/json2.js"></script>
    <link rel="stylesheet" type="text/css" href="default.css" />
    <script type="text/javascript" src="../codebase/GooFlow.js"></script>
    <script type="text/javascript" src="../codebase/GooFlow.color.js"></script>
    <script type="text/javascript" src="../plugin/promise.min.js"></script>
    <script type="text/javascript" src="../plugin/html2canvas.js"></script>
    <!--[if lte IE 11]>
    <script type="text/javascript" src="../plugin/canvg.js"></script>
    <![endif]-->
    <script type="text/javascript" src="../codebase/GooFlow.export-old.js"></script>
    <script type="text/javascript">
        var property = {
            width: 1250,
            height: 600,
            toolBtns: ["start round mix", "end round", "task", "node", "chat", "state", "plug", "join", "fork", "complex mix"],
            haveHead: true,
            headLabel: true,
            headBtns: ["undo", "redo", "reload", "print"],//如果haveHead=true，则定义HEAD区的按钮
            haveTool: true,
            haveDashed: true,
            haveGroup: true,
            useOperStack: true
        };
        var remark = {
            cursor: "选择指针",
            direct: "结点连线",
            start: "入口结点",
            "end": "结束结点",
            "task": "任务结点",
            node: "自动结点",
            chat: "决策结点",
            state: "状态结点",
            plug: "附加插件",
            fork: "分支结点",
            "join": "联合结点",
            "complex mix": "复合结点",
            group: "组织划分框编辑开关"
        };
        var demo;
        $(document).ready(function () {
            //导出图片功能 END
            var exportName = "导出流程图";
            demo = $.createGooFlow($("#demo"), property);
            demo.setNodeRemarks(remark);
            demo.onItemDel = function (id, type) {
                //删除弹框
                this.blurItem();
                return true;
                //		if(confirm("确定要删除该单元吗?")){
                //
                //		}else{
                //      return false;
                //		}
            }
            demo.onPrintClick = function () {
                demo.exportDiagram(exportName);
            }
            //demo.loadData(jsondata);

            //demo.onItemFocus=function(id,model){
            //  var obj;
            //  $("#ele_model").val(model);
            //  $("#ele_id").val(id);
            //  if(model=="line"){
            //    obj=this.$lineData[id];
            //    $("#ele_type").val(obj.M);
            //    $("#ele_left").val("");
            //    $("#ele_top").val("");
            //    $("#ele_width").val("");
            //    $("#ele_height").val("");
            //    $("#ele_from").val(obj.from);
            //    $("#ele_to").val(obj.to);
            //  }else if(model=="node"){
            //    obj=this.$nodeData[id];
            //    $("#ele_left").val(obj.left);
            //      $("#ele_type").val(obj.type);
            //    $("#ele_top").val(obj.top);
            //    $("#ele_width").val(obj.width);
            //    $("#ele_height").val(obj.height);
            //    $("#ele_from").val("");
            //    $("#ele_to").val("");
            //  }
            //  $("#ele_name").val(obj.name);
            //    $("#ele_sort").val(obj.sort);
            //  return true;
            //};
            //demo.onItemBlur=function(id,model){
            //document.getElementById("propertyForm").reset();
            //return true;
            //};
            //demo.resetScale( parseFloat(1.2) );
        });
        var out;

        //导出图片
        function Exportpic() {
            demo.exportDiagram("55");

        }
        //不带id
        function Export() {
            document.getElementById("result").value = JSON.stringify(demo.exportData());
     
        }
        //带id
        function Export2() {
            document.getElementById("result").value = JSON.stringify(demo.exportData2());
        }
        function savenodeinfo() {
            document.getElementById("result").value = JSON.stringify(demo.exportData2());
           
            var nodeinfo = document.getElementById("result").value;
            $.ajax({

                url: "/ProjectReview/CreateTestSort",
                type: 'POST',
                data: {
                    nodeinfo: nodeinfo,
                    MTRNO: "HXW0510"
                  
                },
                success: function (data) {
                 
                }
            });

        }

        //回绑确定按钮
        function Submit(name) {
            demo.setName(demo.$focus, name, "node");
            demo.setName(demo.$focus, name, "line");
            //alert( JSON.stringify(demo.$nodeData));
            //alert( JSON.stringify(demo.getItemInfo(demo.$focus,"node").exportData()) );
        }
        function InputData() {
            demo.loadData(JSON.parse(document.getElementById("inputresult").value));
        }
        function LoadSource(SourceData) {
            demo.loadData(JSON.parse(SourceData));
        }

        function Select(id, oldID) {
            demo.markItem(oldID, "node", false)
            //demo.focusItem(id,true);
            demo.markItem(id, "node", true)

        }
        //清空数据
        function clear() {
            demo.clearData();
        }
        //保存json对象

    </script>
</head>
<body>
    <div id="demo" style="margin:5px;float:left"></div>
    <!--<form class="myForm" id="propertyForm">
    <div class="form_title">属性设置</div>
    <div class="form_content">
      <table>
          <tr><td class="th">Id：</td><td><input type="text" style="width:200px;" id="ele_id"/></td></tr>
          <tr><td class="th">Name：</td><td><input type="text" style="width:200px;" id="ele_name"/></td></tr>
          <tr><td class="th">Type：</td><td><input type="text" style="width:200px;" id="ele_type"/></td></tr>
          <tr><td class="th">Model：</td><td><input type="text" style="width:200px;" id="ele_model"/></td></tr>
          <tr><td class="th">Left-r：</td><td><input type="text" style="width:200px;" id="ele_left"/></td></tr>
          <tr><td class="th">Top-r：</td><td><input type="text" style="width:200px;" id="ele_top"/></td></tr>
          <tr><td class="th">Width：</td><td><input type="text" style="width:200px;" id="ele_width"/></td></tr>
          <tr><td class="th">Height：</td><td><input type="text" style="width:200px;" id="ele_height"/></td></tr>
          <tr><td class="th">From：</td><td><input type="text" style="width:200px;" id="ele_from"/></td></tr>
          <tr><td class="th">To：</td><td><input type="text" style="width:200px;" id="ele_to"/></td></tr>
          <tr><td class="th">Sort：</td><td><input type="text" style="width:200px;" id="ele_sort"/></td></tr>
      </table>
    </div>
    <div class="form_btn_div">
      <input type="reset" value="重置"/>
        <input type="button" value="确定" onclick="Submit($('#ele_name').val());" />
    </div>
    </form>-->
    <div style="clear:both;">
        <input id="submit" type="button" value='导出结果不带ID' onclick="Export()" style="" />
        <input id="submit" type="button" value='导出结果带ID' onclick="Export2()" style="" />
        <input type="button" value='导入结果' id="export_rode" onclick="InputData();" style="" />
        <input type="button" value='下载图片' id="export_pic" onclick="Exportpic();" style="" />
        <a id="Save_Json" href="#" onclick="savenodeinfo();"  style="display:inline-block;border-radius:4px;margin-left:20px;outline:none;width:100px;height:30px;line-height:30px;text-align:center;background:#428bca;color:#fff;text-decoration:none">Save</a>
        <!--获取父页面的选中行的MTR单号-->
        <input id="MTR_no" type="hidden" value=''/>
       
        <textarea id="result" row="6" cols="10" style="width:98%;height:80px;margin:10px auto;"></textarea>
        <div style="height:15px;">导入结果：</div>
        <textarea id="inputresult" row="6" cols="10" style="width:98%;height:80px;margin:10px auto;"></textarea>
    </div>
</body>
</html>
